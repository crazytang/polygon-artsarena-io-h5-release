import{an as G,b0 as Q,a_ as X,b2 as ee,b1 as te,bf as se,ag as f,bi as ae,bx as oe,a$ as re,by as ne,ad as ie,$ as N,bz as ce,bA as le,au as _,av as S,aH as s,ah as e,b5 as p,a4 as v,b6 as b,bc as C,bh as ue,aE as w,aF as h,be as pe,bj as de,bk as T,bb as fe,b3 as m,bB as me,b9 as _e,ba as ve,at as he}from"./index-1e3b5e9c.js";import{S as ge}from"./SelectNFTModal-0ca7b88d.js";import{E as xe}from"./erc721-service-bd0ec81e.js";import{M as D,N as be}from"./match-service-ebe62e39.js";import{i as we,e as ye}from"./regexp-d43f6901.js";import{P as ke}from"./enums-1cf4aa58.js";import{C as Ie}from"./close_icon-ee0c1106.js";import{C as Ne}from"./collection-api-service-816a6e5a.js";import{M as Se}from"./match-api-service-85ee51bf.js";import{C as Ce}from"./contract-api-service-fb5a844b.js";import{T as A}from"./publicUnit-82a6e2b0.js";import{R as Te}from"./air-drop-2b775382.js";import{U as Ae}from"./user-api-service-a6602b04.js";import{I as E}from"./index-d8bf6a34.js";import{P as Be}from"./PlusOutlined-2952e871.js";import"./burn-icon-93c9a88e.js";import"./CloseOutlined-0d6f8edf.js";import"./AntdIcon-17d0cbb0.js";import"./index-f42bfe17.js";import"./firstNotUndefined-748ee901.js";import"./transaction-api-service-8b388dbb.js";import"./utils-518c8eb5.js";import"./match-utils-793d0e6d.js";import"./contract-data-service-bee1e717.js";import"./battle-contract-service-bdced59b.js";import"./challenge-api-service-8347c7e6.js";import"./match-data-ext-5e1df082.js";import"./nft-data-00f9cd4d.js";import"./constants-2bfeaeae.js";import"./collection-data-v2-15891f6d.js";import"./user-data-72a94b9b.js";import"./css-1021bd93.js";import"./useMergedState-69e90c89.js";const j=g=>(_e("data-v-4b83b7a2"),g=g(),ve(),g),Fe={class:"flex space-x-[30px] createRing"},Me={class:"w-[633px] h-full m_width"},Pe={key:0,class:"p-4 space-y-4 m1 m_arenas"},Re={class:"text-xl text-white font-pf"},Ue={class:"flex space-x-3 overflow-x-auto whitespace-nowrap scrollBar-x",ref:"wrapper"},De={class:"inline-block space-x-3"},Ee={class:"text-[20px] text-white font-pf m_title"},je={class:"mb-[15px] text-[15px] f-1 m_text"},Ve={key:0,class:"w-full cursor-pointer"},$e={class:"absolute cursor-pointer top-1 right-1"},ze={class:"w-[536px] p-[30px] m2",style:{"align-self":"baseline"}},Oe={class:"text-xl text-white m_text"},We={class:"mt-3 space-y-2 m_content"},Ke={class:"text-sm font-primary default-family m_content_text"},Ze={class:"text-base font-f font-primary"},qe={class:"text-xs text-[#fff]/[0.5] default-family m_content_text"},He=j(()=>s("span",{class:"text-sm font-bold text-black font-f"},"transfer for staking",-1)),Je={class:"text-sm font-bold text-black font-f"},Le={class:"text-xs text-gray-700"},Ye=j(()=>s("span",{class:"text-sm font-bold text-black font-f"},"continue",-1)),Ge=G({__name:"index",setup(g){const{open:B}=Q(),{t:i}=X(),{chain:y}=ee(),V=new Ne,$=new Te,z=te(),O=se(),o=f(),F=f(),u=f(),M=f(!1),l=f(!1),P=f(),k=f(),R=f("");ae({checked:1,imgs:["https://zos.alipayobjects.com/rmsportal/jkjgkEfvpUPVyRjUImniVslZfWPnJuuZ.png"]});const W=oe.debounce(t=>{t==""||we.test(ye(t))?R.value=t:u.value=R.value},0),{matchId:x}=O.query||{},K={fight:{text:`向 ${k.value} 發出“单挑”挑戰，等待擂主選擇對手`,num:1},team:{text:`向 ${k.value} 發出“團滅戰”挑戰，等待擂主選擇對手`,num:5}},d=re();let U=ne();const Z=async()=>{var t,a;if(console.log(12),!d.address){B();return}(a=(t=F.value)==null?void 0:t.openModal)==null||a.call(t)};ie(async()=>{if(!d.address){B();return}if(U===null||(new Ae().obtainAssetOnChain(d.address,U),x===void 0))return;const a=await new Se().getMatchDataByMatchId(N(),x);V.getNFTData(a.arenaCreatorNftAddress,a.arenaCreatorTokenId).then(r=>{k.value=r.name,P.value=r.imageUri}).catch(r=>{console.error(r)})});function q(t){console.log("data",t),o.value=t}const H=async()=>{if(!(u.value>0))return;if(l.value=!0,isNaN(parseFloat(u.value))||parseFloat(u.value)<=0){m(i("views.ring.t8"),"error",!1),l.value=!1;return}if(!o.value){m(i("views.ring.t9"),"error",!1),l.value=!1;return}const t=o.value.nftAddress,a=o.value.nftTokenId,r=new Ce;let n=await r.getNFTStatus(t,a);if(!n.stakedInPool){const c=N();if(!await me(d.address,c)){m(`You may not finished the transaction, please check your ${A} balance`,"error",!1),M.value=!1;return}await D.stake(c,t,a),n=await r.getNFTStatus(t,a),l.value=!1}if(n.ownerInPool!=d.address){m(i("views.ring.t10"),"error",!1),l.value=!1;return}if(n.stakeStatus!=ke.STAKED){m(i("views.ring.t11"),"error",!1),l.value=!1;return}try{const c=await D.createMatch(d.address,N(),t,a,u.value);await $.everyDayArena(d.address,{itemType:"arena",chainId:y==null?void 0:y.id}),console.log("match_data_param",c),m(i("views.ring.t12"),"success",!1,2,()=>{z.push("/ring/index")}),l.value=!1}catch(c){m(c.message,"error",!1),l.value=!1}},J=async()=>{var t,a;l.value=!0;try{const r=(t=o.value)==null?void 0:t.nftAddress,n=(a=o.value)==null?void 0:a.nftTokenId,c=await be.connect(),Y=await(await xe.connect(r)).safeTransferFrom(d.address,c.getContractAddress(),n);await c.waitForTransaction(Y),o.value.status="BURN"}catch(r){m(r.message,"error",!1)}finally{l.value=!1}},L=()=>{o.value=null};return(t,a)=>{const r=ce("loading");return le((_(),S("div",Fe,[s("section",Me,[e(x)?(_(),S("div",Pe,[s("p",Re,p(K.fight.text),1),s("div",Ue,[s("div",De,[v(e(E),{width:70,height:70,src:P.value,preview:!1},null,8,["src"])])],512)])):b("",!0),s("div",{class:C(["w-full h-full p-[30px] m1 default-family m_my_select",e(x)?"mt-5":""])},[s("p",Ee,p(e(i)("views.ring.create.select")),1),s("p",je,p(e(i)("views.ring.create.loseTips")),1),s("div",{class:"relative flex items-center justify-center w-full h-full bg-black m1-add",style:{border:"1px solid #393939"},onClick:Z},[o.value?(_(),S("div",Ve,[v(e(pe),{src:o.value.imageUri},null,8,["src"]),s("div",$e,[v(e(E),{width:30,height:30,src:e(Ie),preview:!1,onClick:ue(L,["stop"])},null,8,["src","onClick"])])])):(_(),w(e(Be),{key:1,class:"cursor-pointer text-7xl f-2"}))])],2)]),s("section",ze,[s("p",Oe,p(e(i)("views.ring.create.setNftPrice")),1),s("div",We,[s("p",Ke,p(e(i)("views.ring.create.winTips",{unit:e(A)})),1),v(e(de),{value:u.value,"onUpdate:value":a[0]||(a[0]=n=>u.value=n),class:"custom-input font-f",onInput:a[1]||(a[1]=n=>e(W)(n.target.value))},{suffix:h(()=>[s("span",Ze,p(e(A)),1)]),_:1},8,["value"]),s("p",qe,p(e(i)("views.ring.create.tips")),1)]),v(e(fe),{spinning:l.value},{default:h(()=>{var n,c,I;return[((n=o.value)==null?void 0:n.status)=="approved"||((c=o.value)==null?void 0:c.status)=="unApproved"?(_(),w(e(T),{key:0,class:C(["rounded-sm mt-7 bg-primary",u.value>0?"bg-primary":"cursor-not-allowed unBtn"]),onClick:J},{default:h(()=>[He]),_:1},8,["class"])):b("",!0),((I=o.value)==null?void 0:I.status)=="BURN"?(_(),w(e(T),{key:1,class:C(["rounded-sm mt-7 event_create_arena bg-primary",u.value>0?"bg-primary":"cursor-not-allowed unBtn"]),onClick:H},{default:h(()=>[s("span",Je,p(e(i)("views.fightInfo.t16")),1),s("span",Le,p(e(i)("views.ring.create.submitSubText")),1)]),_:1},8,["class"])):b("",!0),o.value?b("",!0):(_(),w(e(T),{key:2,class:"cursor-not-allowed mt-7 bg-[#333333] rounded-sm"},{default:h(()=>[Ye]),_:1}))]}),_:1},8,["spinning"])]),v(ge,{ref_key:"selectNFTRef",ref:F,onSuccess:q,class:"modalcomponent"},null,512)])),[[r,M.value]])}}});const Ft=he(Ge,[["__scopeId","data-v-4b83b7a2"]]);export{Ft as default};
