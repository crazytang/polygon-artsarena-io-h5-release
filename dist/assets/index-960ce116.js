import{an as te,b0 as se,a_ as ae,ag as p,bf as oe,b1 as re,$ as ne,a$ as ie,b2 as le,ad as E,b3 as f,bx as ce,au as u,av as y,aH as o,b5 as l,ah as a,bd as ue,aY as P,b7 as q,a4 as g,be as de,bh as pe,aE as v,aF as b,bD as T,bj as fe,bc as j,bk as S,b6 as B,bb as me,b9 as he,ba as _e,at as ve}from"./index-1e3b5e9c.js";import{S as ge}from"./SelectNFTModal-0ca7b88d.js";import{C as be}from"./close_icon-ee0c1106.js";import{B as we}from"./core.esm-b974a788.js";import{M as xe}from"./match-api-service-85ee51bf.js";import{C as ye}from"./collection-api-service-816a6e5a.js";import{M as ke}from"./enums-1cf4aa58.js";import{M as Ce,N as Ie}from"./match-service-ebe62e39.js";import{i as Ne,e as Ae}from"./regexp-d43f6901.js";import{E as Te}from"./erc721-service-bd0ec81e.js";import{C as Se}from"./challenge-api-service-8347c7e6.js";import{T as V}from"./publicUnit-82a6e2b0.js";import{R as Be}from"./air-drop-2b775382.js";import{U as Me}from"./user-api-service-a6602b04.js";import{I as M}from"./index-d8bf6a34.js";import{P as Re}from"./PlusOutlined-2952e871.js";import"./burn-icon-93c9a88e.js";import"./CloseOutlined-0d6f8edf.js";import"./AntdIcon-17d0cbb0.js";import"./index-f42bfe17.js";import"./firstNotUndefined-748ee901.js";import"./match-data-ext-5e1df082.js";import"./nft-data-00f9cd4d.js";import"./collection-data-v2-15891f6d.js";import"./match-utils-793d0e6d.js";import"./transaction-api-service-8b388dbb.js";import"./utils-518c8eb5.js";import"./contract-data-service-bee1e717.js";import"./battle-contract-service-bdced59b.js";import"./constants-2bfeaeae.js";import"./user-data-72a94b9b.js";import"./css-1021bd93.js";import"./useMergedState-69e90c89.js";const L=w=>(he("data-v-ecbcfffb"),w=w(),_e(),w),De={class:"flex space-x-[30px] createRing default-family"},Fe={class:"w-[633px] h-full m_header"},Ue={class:"p-4 space-y-4 m1 m_header_content"},$e={class:"text-xl text-white font-f m_header_content_title"},Ee={class:"inline-block space-x-3 h-[70px] scrollBar-x"},Pe={class:"mobile-tip-box"},qe={class:"par"},je={class:"w-full h-full p-[30px] m1 mt-5 m_header_content m_content"},Ve={class:"text-[20px] text-white font-f m_header_content_title"},Le={class:"mb-[15px] text-[15px] f-1 m_header_content_tip"},Oe={key:0,class:"w-full cursor-pointer"},Ye={class:"absolute cursor-pointer top-1 right-1"},ze={class:"w-[536px] p-[30px] m2",style:{"align-self":"baseline"}},He={class:"text-xl text-white font-f"},Ke={class:"mt-3 space-y-2"},We={class:"text-sm font-primary"},Xe={class:"text-base font-f font-primary"},Ge={class:"text-xs text-[#fff]/[0.5] default-family"},Je=L(()=>o("span",{class:"text-sm font-bold text-black font-f"},"transfer for staking",-1)),Qe={class:"text-sm font-bold text-black font-f"},Ze={class:"text-xs text-gray-700"},et=L(()=>o("span",{class:"text-sm font-bold text-black font-f"},"continue",-1)),tt=te({__name:"index",setup(w){const{open:R}=se(),O=new xe,Y=new Be,z=new ye,H=new Se,{t:r}=ae(),D=p(),[K,k]=[oe(),re()],F=p(),x=p([]),C=p([]),c=p(!1),U=p("");let i=[];const I=ne(),m=ie(),{chain:N}=le(),n=p(),h=p();let A=[];E(async()=>{const e=K.query.match_id;T(e)?i=e:e!=null&&i.push(e);for(let t=0;t<i.length;t++){const s=await O.getMatchDataByMatchId(I,i[t]);s&&s.matchStatus==ke.READY&&(s.arenaCreatorAddress==m.address&&f(r("views.ring.t16"),"error",!1,2,()=>{k.back()}),x.value.push(s))}for(let t=0;t<x.value.length;t++){const s=await z.getNFTData(x.value[t].arenaCreatorNftAddress,x.value[t].arenaCreatorTokenId);C.value.push(s)}});const W=()=>{var e,t;if(!m.address){R();return}(t=(e=F.value)==null?void 0:e.openModal)==null||t.call(e)},X=ce.debounce(e=>{e==""||Ne.test(Ae(e))?U.value=e:h.value=U.value},0),G=async()=>{if(c.value=!0,!m.address){c.value=!1,R();return}if(Number(h.value)<=0){f(r("views.ring.t2"),"error",!1),c.value=!1;return}if(!n.value){f(r("views.ring.t3"),"error",!1),c.value=!1;return}if(i.length==0){f(r("views.ring.t4"),"error",!1),c.value=!1;return}try{let e=!1;for(let t=0;t<i.length;t++){if(A.includes(i[t])){f(r("views.ring.t17",{n:t+1}),"warning",!1);continue}const s=await Ce.challengeMatch(i[t],m.address,I,n.value.nftAddress,Number(n.value.nftTokenId),Number(h.value),!0);await Y.everyDayChallenge(m.address,{itemType:"challenge",chainId:N==null?void 0:N.id}),e=!0,console.log("match_data_param",s)}c.value=!1,e&&(f(r("views.ring.t6"),"success",!1),k.push({path:"/ring"}))}catch(e){console.log("e",e),f(`${r("views.ring.t5")} error: ${e.message}`,"error",!1),c.value=!1}},J=async()=>{var e,t;c.value=!0;try{const s=(e=n.value)==null?void 0:e.nftAddress,d=(t=n.value)==null?void 0:t.nftTokenId,_=await Ie.connect(),ee=await(await Te.connect(s)).safeTransferFrom(m.address,_.getContractAddress(),d);await _.waitForTransaction(ee),n.value.status="BURN"}catch(s){f(s.message,"error",!1)}finally{c.value=!1}},Q=()=>{n.value=null},Z=async e=>{if(console.log("nft_data_ext",e),A=[],n.value=e,i.length>0)for(let t=0;t<i.length;t++){const s=await H.getChallengeDataByMatchIdAndNftAddressAndTokenId(i[t],e.nftAddress,e.nftTokenId);s&&s.matchId==i[t]&&A.push(i[t])}};E(()=>{new we(D.value,{scrollX:!0,probeType:3}),new Me().obtainAssetOnChain(m.address,I)});const $=e=>{const{nftAddress:t,nftTokenId:s}=e;k.push({path:"/detail/index",query:{nft_address:t,token_id:s}})};return(e,t)=>(u(),y("div",De,[o("section",Fe,[o("div",Ue,[o("p",$e,l(a(r)("views.ring.batchChallenge.title[0]"))+" "+l(a(T)(e.$route.query.match_id)?e.$route.query.match_id.length:1)+" "+l(a(r)("views.ring.batchChallenge.title[1]"))+" "+l(a(T)(e.$route.query.match_id)?e.$route.query.match_id.length:1)+" "+l(a(r)("views.ring.batchChallenge.title[2]")),1),ue(" div "),o("div",{class:"flex space-x-3 overflow-x-auto whitespace-nowrap scrollBar-x m_header_content_tip",ref_key:"wrapper",ref:D},[o("div",Ee,[(u(!0),y(P,null,q(C.value,(s,d)=>(u(),v(a(M),{key:d,width:70,height:70,src:s.cacheImageUrl,preview:!1,onClick:_=>$(s),class:"object-contain cursor-pointer"},null,8,["src","onClick"]))),128))])],512),o("div",Pe,[o("div",qe,[(u(!0),y(P,null,q(C.value,(s,d)=>(u(),v(a(M),{key:d,width:70,height:70,src:s.cacheImageUrl,preview:!1,onClick:_=>$(s),class:"object-contain cursor-pointer"},null,8,["src","onClick"]))),128))])])]),o("div",je,[o("p",Ve,l(a(r)("views.ring.batchChallenge.selectNft")),1),o("p",Le,l(a(r)("views.ring.create.loseTips")),1),o("div",{class:"relative flex items-center justify-center w-full h-full bg-black m1-add",style:{border:"1px solid #393939"},onClick:W},[n.value?(u(),y("div",Oe,[g(de,{src:n.value.imageUri},null,8,["src"]),o("div",Ye,[g(a(M),{width:30,height:30,src:a(be),preview:!1,onClick:pe(Q,["stop"])},null,8,["src","onClick"])])])):(u(),v(a(Re),{key:1,class:"cursor-pointer text-7xl f-2"}))])])]),o("section",ze,[o("p",He,l(a(r)("views.ring.create.setNftPrice")),1),o("div",Ke,[o("p",We,l(a(r)("views.ring.create.winTips",{unit:a(V)})),1),g(a(fe),{class:"custom-input",value:h.value,"onUpdate:value":t[0]||(t[0]=s=>h.value=s),onInput:t[1]||(t[1]=s=>a(X)(s.target.value))},{suffix:b(()=>[o("span",Xe,l(a(V)),1)]),_:1},8,["value"]),o("p",Ge,l(a(r)("views.ring.create.tips")),1)]),g(a(me),{spinning:c.value},{default:b(()=>{var s,d,_;return[((s=n.value)==null?void 0:s.status)=="approved"||((d=n.value)==null?void 0:d.status)=="unApproved"?(u(),v(a(S),{key:0,class:j(["rounded-sm mt-7 bg-primary",h.value>0?"bg-primary":"cursor-not-allowed unBtn"]),onClick:J},{default:b(()=>[Je]),_:1},8,["class"])):B("",!0),((_=n.value)==null?void 0:_.status)=="BURN"?(u(),v(a(S),{key:1,class:j(["mt-7 event_challenge bg-primary",h.value>0?"bg-primary":"cursor-not-allowed unBtn"]),onClick:G},{default:b(()=>[o("span",Qe,l(a(r)("views.fightInfo.t16")),1),o("span",Ze,l(a(r)("views.ring.create.submitTip")),1)]),_:1},8,["class"])):B("",!0),n.value?B("",!0):(u(),v(a(S),{key:2,class:"cursor-not-allowed mt-7 bg-[#333333] rounded-sm"},{default:b(()=>[et]),_:1}))]}),_:1},8,["spinning"])]),g(ge,{ref_key:"selectNFTRef",ref:F,onSuccess:Z},null,512)]))}});const $t=ve(tt,[["__scopeId","data-v-ecbcfffb"]]);export{$t as default};
